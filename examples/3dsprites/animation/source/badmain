#include <stdio.h>
#include <time.h>

#include <nds.h>
#include <filesystem.h>

#include <nf_lib.h>
int main(){
    srand(time(NULL));

    // Prepare a NitroFS initialization screen
    NF_Set2D(0, 0);
    NF_Set2D(1, 0);
    consoleDemoInit();
    printf("\n NitroFS init. Please wait.\n\n");
    printf(" Iniciando NitroFS,\n por favor, espere.\n\n");
    swiWaitForVBlank();

    // Initialize NitroFS and set it as the root folder of the filesystem
    nitroFSInit(NULL);
    
    NF_SetRootFolder("NITROFS");

    // Initialize 3D engine in the top screen in mode 0
    NF_Set3D(0, 0);

    // Initialize 2D engine in the bottom
    NF_Set2D(1, 0);

    // Initialize tiled backgrounds system
    NF_InitTiledBgBuffers();    // Initialize storage buffers
    NF_InitTiledBgSys(0);       // Top screen
    NF_InitTiledBgSys(1);       // Bottom screen

    // Initialize 3D sprite system
    NF_InitSpriteBuffers();     // Initialize storage buffers
    NF_Init3dSpriteSys();

    // Load background files from NitroFS
    NF_LoadTiledBg("bg/nfl", "nfl", 256, 256);
    NF_LoadTiledBg("bg/bg3", "bg3", 256, 256);

    NF_LoadSpriteGfx("sprite/numbers", 0, 16, 16);
    NF_LoadSpritePal("sprite/numbers", 0);
    NF_Vram3dSpriteGfx(0, 0, true);
    NF_Vram3dSpritePal(0, 0);
    NF_CreateTiledBg(0, 3, "bg3");
    NF_CreateTiledBg(1, 3, "nfl");

    NF_Sort3dSprites();
    NF_Set3dSpriteFrame(n, frame[n]);

            NF_Draw3dSprites();

        // Tell the GPU to draw the scene and wait until it's done
    glFlush(0);

        // Wait for the screen refresh
    swiWaitForVBlank();

        // Update textures of any 3D sprite with "keepframes == true"
    NF_Update3dSpritesGfx();
}